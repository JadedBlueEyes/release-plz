"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[361],{6964:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var r=n(5893),a=n(1151);const l={},t="release",i={id:"usage/release",title:"release",description:"The release-plz release command releases all the unpublished packages.",source:"@site/docs/usage/release.md",sourceDirName:"usage",slug:"/usage/release",permalink:"/docs/usage/release",draft:!1,unlisted:!1,editUrl:"https://github.com/MarcoIeni/release-plz/tree/main/website/docs/usage/release.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"release-pr",permalink:"/docs/usage/release-pr"},next:{title:"init",permalink:"/docs/usage/init"}},o={},c=[{value:"Gitlab",id:"gitlab",level:2},{value:"Gitea",id:"gitea",level:2}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"release",children:"release"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"release-plz release"})," command releases all the unpublished packages."]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["For example, let's say you have a workspace with two packages: ",(0,r.jsx)(s.code,{children:"pkg-a"}),"\n(version 0.3.1) and ",(0,r.jsx)(s.code,{children:"pkg-b"})," (version 0.2.2).\nThe crates.io registry contains ",(0,r.jsx)(s.code,{children:"pkg-a"})," version 0.3.1, but it doesn't contain\n",(0,r.jsx)(s.code,{children:"pkg-b"})," version 0.2.2 because you didn't publish this version yet.\nIn this case, release-plz would release ",(0,r.jsx)(s.code,{children:"pkg-b"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"For every release, release-plz:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Creates a git tag named ",(0,r.jsx)(s.code,{children:"<package_name>-v<version>"})," (e.g. ",(0,r.jsx)(s.code,{children:"tokio-v1.8.1"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Publishes the package to the cargo registry by running ",(0,r.jsx)(s.code,{children:"cargo publish"}),"."]}),"\n",(0,r.jsx)(s.li,{children:"Publishes a GitHub/Gitea/GitLab release based on the git tag."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["In the tag name, ",(0,r.jsx)(s.code,{children:"<package_name>-"})," is omitted if there's only one\npackage to publish (i.e. with ",(0,r.jsx)(s.code,{children:"publish != false"})," in the ",(0,r.jsx)(s.code,{children:"Cargo.toml"})," file)."]}),"\n",(0,r.jsxs)(s.p,{children:["Note that ",(0,r.jsx)(s.code,{children:"release-plz release"})," doesn't edit your ",(0,r.jsx)(s.code,{children:"Cargo.toml"})," files and doesn't\npush new commits. It releases the packages as they are in your repository.\nFor this reason, you typically use the ",(0,r.jsx)(s.code,{children:"release-plz release"})," command in the main branch\nafter you run ",(0,r.jsx)(s.code,{children:"release-plz update"}),"\nor you merge a pull request opened with ",(0,r.jsx)(s.code,{children:"release-plz release-pr"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["If all packages are already published, the ",(0,r.jsx)(s.code,{children:"release-plz release"})," command does nothing."]}),"\n",(0,r.jsxs)(s.p,{children:["To learn more, run ",(0,r.jsx)(s.code,{children:"release-plz release --help"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"gitlab",children:"Gitlab"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"releases-plz"})," also supports creating releases on Gitlab with the ",(0,r.jsx)(s.code,{children:"--backend gitlab"})," option."]}),"\n",(0,r.jsxs)(s.p,{children:["The default token in CI does not have permissions to create tags, so you will need to\na custom ",(0,r.jsx)(s.a,{href:"https://docs.gitlab.com/ee/user/project/settings/project_access_tokens.html",children:"access token"}),".\nThe permissions you need are:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"api"})," (to create a release)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"write_repository"})," (to create tag)"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Then you can run ",(0,r.jsx)(s.code,{children:"release-plz release"})," in Gitlab CI with the following arguments:"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:"release-plz release --backend gitlab --git-token <gitlab application token>"})}),"\n",(0,r.jsx)(s.h2,{id:"gitea",children:"Gitea"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"releases-plz"})," also supports creating releases on Gitea with the ",(0,r.jsx)(s.code,{children:"--backend gitea"})," option."]}),"\n",(0,r.jsx)(s.p,{children:"TODO: document how to create a token on Gitea."})]})}function h(e={}){const{wrapper:s}={...(0,a.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,s,n)=>{n.d(s,{Z:()=>i,a:()=>t});var r=n(7294);const a={},l=r.createContext(a);function t(e){const s=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(l.Provider,{value:s},e.children)}}}]);